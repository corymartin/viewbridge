#!/usr/bin/env node

var program    = require('commander');
var viewbridge = require('../lib/index');
var pkg        = require('../package');


function list(str) {
  return str.split(',');
};


program
  .version(pkg.version)
  .usage('-d app/views -v v1,v2 -o deploy/tmpl.js [options]')
  .option('-d, --dir <dir>', 'directory of template files - required')
  .option('-v, --views <view1,view2,..>', 'templates to compile', list)
  .option('-o, --output <output>', 'output file path')
  .option('-n, --namespace <namespace>', 'clientside namespace - default is `viewbridge`')
  .option('-e, --engine <engine>', 'template engine - default is `jade`')
  .option('-E, --ext <extension>', 'file extension - defaults are Jade:`.jade`, Hogan:`.hjs`')
  .parse(process.argv);


if (!program.dir) {
  console.error('\nError: Required arguments missing.');
  program.help();
  process.exit(1);
}


viewbridge(
  {
    dir:       program.dir
  , namespace: program.namespace
  , output:    program.output
  , views:     program.views
  , engine:    program.engine
  , ext:       program.ext
  }
, function(err, info) {
    if (err) {
      console.error('\nError:\n', err);
      process.exit(1);
    }
    if (program.output)
      console.info(info.file);
    else
      console.log(info.javascript);
  }
);
